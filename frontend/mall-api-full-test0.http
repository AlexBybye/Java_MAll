### Mall System API 完整测试文件
### 定义环境变量
@baseUrl = http://localhost:8080/api
@testUsername = testuser_complete
@testPassword = testpassword123
@testEmail = testuser_complete@example.com
@testPhone = 13800000001
@adminUsername = admin
@adminPassword = adminVIP
@adminPhone = 10000000000
@token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJNYWxsU3lzdGVtIiwic3ViIjoiNSIsInVzZXJuYW1lIjoidGVzdHVzZXJfY29tcGxldGUiLCJpc0FkbWluIjpmYWxzZSwiaWF0IjoxNzY1NTY5ODA0LCJleHAiOjE3NjU1NzM0MDR9.hOm4lo14pMDYPv8HHjcLPka77aPJxd4le09vqUqKcCA
@adminToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJNYWxsU3lzdGVtIiwic3ViIjoiNiIsInVzZXJuYW1lIjoiYWRtaW4iLCJpc0FkbWluIjp0cnVlLCJpYXQiOjE3NjU1Nzc2ODUsImV4cCI6MTc2NTU4MTI4NX0.I34fdIP5mZ7KncLWZh1JzHNdvceWuZEwSnsj2AcgIWM
### 1. 顾客管理模块 (Customer Management)
### ===============================================================================

### 1.1 注册新用户 (RegisterServlet)
POST {{baseUrl}}/register
Content-Type: application/json

{
    "username": "{{testUsername}}",
    "password": "{{testPassword}}",
    "email": "{{testEmail}}",
    "phone": "{{testPhone}}"
}

### 1.2 用户登录 (LoginServlet)
POST {{baseUrl}}/login
Content-Type: application/json

{
    "username": "{{testUsername}}",
    "password": "{{testPassword}}"
}

### 1.3 获取顾客个人资料 (CustomerServlet)
GET {{baseUrl}}/customer/profile
Content-Type: application/json
Authorization: Bearer {{token}}

### 1.4 更新顾客个人资料 (CustomerServlet)
PUT {{baseUrl}}/customer/profile
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "email": "updated_{{testEmail}}",
    "phone": "13800000002"
}

### ===============================================================================
### 2. 产品管理模块 (Product Management)
### ===============================================================================

### 2.1 获取产品列表 (ProductServlet - 无需认证)
GET {{baseUrl}}/product
Content-Type: application/json

### 2.2 获取单个产品详情 (ProductServlet - 无需认证)
GET {{baseUrl}}/product/1
Content-Type: application/json

### 2.3 管理员登录 (用于产品管理操作)
POST {{baseUrl}}/login
Content-Type: application/json

{
    "username": "{{adminUsername}}",
    "password": "{{adminPassword}}"
}

> {%
    client.global.set("adminToken", response.body.token);
%}

### 2.4 添加新产品 (ProductServlet)
POST {{baseUrl}}/product
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "name": "测试产品 - 手机",
  "description": "最新款智能手机，高性能，长续航",
  "price": 3999.00,
  "stockQuantity": 100,
  "imageUrl": "http://example.com/phone.jpg"
}

### 2.5 更新产品信息 (ProductServlet)
PUT {{baseUrl}}/product/2
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "name": "测试产品 - 手机 (更新)",
  "description": "最新款智能手机，高性能，长续航，支持5G",
  "price": 4299.00,
  "stockQuantity": 150,
  "imageUrl": "http://example.com/phone_updated.jpg"
}

### 2.6 删除产品 (ProductServlet)
DELETE {{baseUrl}}/product/3
Content-Type: application/json
Authorization: Bearer {{adminToken}}

### ===============================================================================
### 3. 购物车模块 (Cart Management)
### ===============================================================================

### 3.1 普通用户登录 (用于购物车操作)
POST {{baseUrl}}/login
Content-Type: application/json

{
    "username": "{{testUsername}}",
    "password": "{{testPassword}}"
}

> {%
    client.global.set("token", response.body.token);
%}

### 3.2 添加商品到购物车 (CartServlet)
POST {{baseUrl}}/cart
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "productId": 1,
  "quantity": 2
}

### 3.3 获取购物车内容 (CartServlet)
GET {{baseUrl}}/cart
Content-Type: application/json
Authorization: Bearer {{token}}

### 3.4 更新购物车商品数量 (CartServlet)
PUT {{baseUrl}}/cart/1
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "quantity": 3
}

### 3.5 删除购物车中的商品 (CartServlet)
DELETE {{baseUrl}}/cart/1
Content-Type: application/json
Authorization: Bearer {{token}}

### ===============================================================================
### 4. 订单模块 (Order Management)
### ===============================================================================

### 4.1 重新添加商品到购物车 (用于创建订单)
POST {{baseUrl}}/cart
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "productId": 1,
  "quantity": 2
}

### 4.2 获取购物车内容 (确认cartItemId)
GET {{baseUrl}}/cart
Content-Type: application/json
Authorization: Bearer {{token}}

### 4.3 创建订单 (OrderServlet) - 核心功能
POST {{baseUrl}}/order
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "shippingAddress": "北京市海淀区中关村大街1号",
  "cartItemIds": [12]
}
### 4.4 获取用户订单列表 (OrderServlet)
GET {{baseUrl}}/order
Content-Type: application/json
Authorization: Bearer {{token}}

### 4.5 获取单个订单详情 (OrderServlet)
GET {{baseUrl}}/order/6
Content-Type: application/json
Authorization: Bearer {{token}}

### ===============================================================================
### 5. 销售管理模块 (Sales Management)
### ===============================================================================

### 5.1 管理员登录 (用于销售管理操作)
POST {{baseUrl}}/login
Content-Type: application/json

{
    "username": "{{adminUsername}}",
    "password": "{{adminPassword}}"
}

> {%
    client.global.set("adminToken", response.body.token);
%}

### 5.2 获取所有订单 (管理员权限) (OrderServlet)
GET {{baseUrl}}/order/all
Content-Type: application/json
Authorization: Bearer {{adminToken}}

### 5.3 更新订单状态 (管理员权限) (OrderServlet)
PUT {{baseUrl}}/order/3/status
Content-Type: application/json
Authorization: Bearer {{adminToken}}

{
  "status": "SHIPPED"
}

### 5.4 获取销售统计 - 每日销售额 (StatsServlet)
GET {{baseUrl}}/stats/daily?startDate=2025-01-01&endDate=2025-12-31
Content-Type: application/json
Authorization: Bearer {{adminToken}}

### 5.5 获取销售统计 - 月度销售额 (StatsServlet)
GET {{baseUrl}}/stats/monthly?year=2025
Content-Type: application/json
Authorization: Bearer {{adminToken}}

### 5.6 获取销售统计 - 热销商品 (StatsServlet)
GET {{baseUrl}}/stats/top-products?limit=10
Content-Type: application/json
Authorization: Bearer {{adminToken}}

### 5.7 获取销售统计 - 订单状态统计 (StatsServlet)
GET {{baseUrl}}/stats/order-status
Content-Type: application/json
Authorization: Bearer {{adminToken}}

### 5.8 获取所有销售统计数据 (StatsServlet)
GET {{baseUrl}}/stats
Content-Type: application/json
Authorization: Bearer {{adminToken}}

### ===============================================================================
### 6. 测试用例清理
### ===============================================================================

### 6.1 删除测试用户创建的订单 (管理员权限)
DELETE {{baseUrl}}/order/2
Content-Type: application/json
Authorization: Bearer {{adminToken}}

### 6.2 删除测试产品 (管理员权限)
DELETE {{baseUrl}}/product/2
Content-Type: application/json
Authorization: Bearer {{adminToken}}
